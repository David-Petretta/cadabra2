
def test01():
    __cdbkernel__=create_scope()
ex:=A + B D G + C D A;
take_match(_, $D Q??$)
substitute(_, $A = Q$)
    replace_match(_)
    tst:= A + B D G + C D Q - @(ex);
    assert(tst==0)
    print("Test 01 passed")

test01()

def test02():
    __cdbkernel__=create_scope()
    a:= A,B,C;
    b:= D,E,F;
    c:= Q;
    d:= R+S;
    ex1=a+b
    ex2=a+c
    ex3=c+a
    ex4=a+d
    tst1:= {A,B,C,D,E,F} - @(ex1);
    tst2:= {A,B,C,Q} - @(ex2);
    tst3:= {Q,A,B,C} - @(ex3);
    tst4:= {A,B,C,R+S} - @(ex4);
    assert(tst1==0)
    assert(tst2==0)
    assert(tst3==0)
    assert(tst4==0)
    print("Test 02 passed")

test02()

def test03():
    # take_match should also work to select terms in an integral
    # and then replace them later.
    __cdbkernel__=create_scope()
    ex:= 5\int{A+3 B M + C N+D}{dx};
    take_match(_, $B Q??$)
    substitute(_, $B->2 P$)
    replace_match(_)
    tst:= 5\int{A + 6 P M + C N + D}{dx} - @(ex);
    assert(tst==0)
    print("Test 03 passed")

test03()

def test04():
    # take_match should also work to select terms in an integral
    # and then replace them later.
    __cdbkernel__=create_scope()
    ex:= 5\int{A+3 B M + C N+D}{dx};
    take_match(_, $B Q??$)
    substitute(_, $B->0$)
    replace_match(_)
    tst:= 5\int{A + C N + D}{dx} - @(ex);
    assert(tst==0)
    print("Test 04 passed")

test04()

def test05():
    __cdbkernel__=create_scope()
    \partial{#}::PartialDerivative;
    ex:=\int{A_{i} h_{j} + \partial_{i}{B_{j}} D }{x};
    take_match(_, $\partial_{i}{B_{j}} Q??$);
    substitute(_, $D -> E$);
    replace_match(_);
    tst:=\int{A_{i} h_{j} + \partial_{i}{B_{j}} E}{x} - @(ex);
    assert(tst==0)
    print("Test 05 passed")

test05()
